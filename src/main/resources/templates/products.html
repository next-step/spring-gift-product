<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>상품 관리</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .form-container {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: inline-block;
            width: 100px;
            font-weight: bold;
        }
        input[type="text"], input[type="number"], input[type="url"] {
            width: 300px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .delete-btn {
            background-color: #dc3545;
        }
        .delete-btn:hover {
            background-color: #c82333;
        }
        .edit-btn {
            background-color: #28a745;
        }
        .edit-btn:hover {
            background-color: #1e7e34;
        }
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .product-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background-color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .selected-product {
            background-color: #e7f3ff;
            border: 2px solid #007bff;
        }
        .error {
            color: #dc3545;
            background-color: #f8d7da;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .success {
            color: #155724;
            background-color: #d4edda;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
<h1>상품 관리</h1>

<!-- 에러 메시지 -->
<div th:if="${errorMessage}" class="error">
    <p th:text="${errorMessage}">에러 메시지</p>
</div>

<!-- 성공 메시지 -->
<div th:if="${successMessage}" class="success">
    <p th:text="${successMessage}">성공 메시지</p>
</div>

<!-- 상품 추가/수정 폼 -->
<div class="form-container">
    <h2 th:text="${selectedProduct != null ? '상품 수정' : '새 상품 등록'}"></h2>
    <form th:action="@{/api/products}" method="post">
        <!-- ID 입력 필드 -->
        <div class="form-group">
            <label for="id">상품 ID:</label>
            <!-- 수정 모드일 때: 읽기 전용 -->
            <input th:if="${selectedProduct != null}"
                   type="text" id="id" name="id" readonly
                   th:value="${selectedProduct.id}"
                   style="background-color: #f5f5f5; cursor: not-allowed;" />
            <!-- 추가 모드일 때: 입력 가능 -->
            <input th:if="${selectedProduct == null}"
                   type="text" id="id" name="id" required
                   pattern="[0-9]*"
                   inputmode="numeric"
                   placeholder="숫자만 입력하세요 (예: 1, 2, 3...)" />
        </div>

        <div class="form-group">
            <label for="name">상품명:</label>
            <input type="text" id="name" name="name" required
                   th:value="${selectedProduct != null ? selectedProduct.name : ''}" />
        </div>

        <div class="form-group">
            <label for="price">가격:</label>
            <input type="text" id="price" name="price" required
                   pattern="[0-9]*"
                   inputmode="numeric"
                   placeholder="숫자만 입력하세요"
                   th:value="${selectedProduct != null ? selectedProduct.price : ''}" />
        </div>

        <div class="form-group">
            <label for="imageURL">이미지 URL:</label>
            <input type="url" id="imageURL" name="imageURL"
                   placeholder="예: https://example.com/image.jpg"
                   pattern="https?://.+"
                   title="http:// 또는 https://로 시작하는 올바른 URL을 입력하세요"
                   th:value="${selectedProduct != null ? selectedProduct.imageURL : ''}" />
        </div>

        <button type="submit" th:text="${selectedProduct != null ? '수정하기' : '추가하기'}">추가하기</button>

        <!-- 수정 모드일 때 취소 버튼 -->
        <a th:if="${selectedProduct != null}" href="/api/products">
            <button type="button">취소</button>
        </a>
    </form>
</div>

<!-- 상품 목록 -->
<h2>상품 목록</h2>
<div th:if="${allProducts != null and !allProducts.isEmpty()}" class="product-grid">
    <div th:each="product : ${allProducts}"
         th:class="${selectedProduct != null and selectedProduct.id == product.id ? 'product-card selected-product' : 'product-card'}">

        <!-- 상품 이미지 -->
        <img th:if="${product.imageURL != null and !product.imageURL.isEmpty()}"
             th:src="${product.imageURL}"
             th:alt="${product.name}"
             class="product-image"
             onerror="this.style.display='none'" />

        <!-- 상품 정보 -->
        <h3 th:text="${product.name}">상품명</h3>
        <p><strong>ID:</strong> <span th:text="${product.id}"></span></p>
        <p><strong>가격:</strong> <span th:text="|${#numbers.formatInteger(product.price, 0, 'COMMA')}원|"></span></p>

        <!-- 액션 버튼들 -->
        <div style="margin-top: 15px;">
            <!-- 수정 버튼 -->
            <a th:href="@{/api/products/edit(id=${product.id})}">
                <button type="button" class="edit-btn">수정</button>
            </a>

            <!-- 삭제 버튼 -->
            <form style="display: inline;" th:action="@{/api/products/delete(id=${product.id})}" method="post"
                  onsubmit="return confirm('정말로 이 상품을 삭제하시겠습니까?');">
                <input type="hidden" name="id" th:value="${product.id}" />
                <button type="submit" class="delete-btn">삭제</button>
            </form>
        </div>
    </div>
</div>

<!-- 상품이 없을 때 메시지 -->
<div th:if="${allProducts == null or allProducts.isEmpty()}">
    <p>등록된 상품이 없습니다.</p>
</div>
</body>
</html>